class PerformanceOptimizer{constructor(){this.isMusicPage=window.location.pathname.includes("/music/"),this.preloadedResources=new Set,this.init()}init(){this.isMusicPage&&this.optimizeMusicPage(),this.optimizeNavigation(),this.setupPerformanceMonitoring(),this.registerServiceWorker()}optimizeMusicPage(){this.preloadCriticalResources(),this.optimizeIframeLoading(),this.connectionAwareLoading()}preloadCriticalResources(){["/about/","/publications/","/cv/","/repositories/"].forEach((e=>{const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)}));["/assets/css/bootstrap.min.css","/assets/css/main.css","/assets/js/bootstrap.bundle.min.js"].forEach((e=>{const t=document.createElement("link");t.rel="preload",t.href=e,t.as=e.includes(".css")?"style":"script",document.head.appendChild(t)}))}optimizeIframeLoading(){if("IntersectionObserver"in window){const e=new IntersectionObserver((e=>{e.forEach((e=>{if(e.isIntersecting){const t=e.target;t.dataset.src&&!t.src&&(t.src=t.dataset.src,t.removeAttribute("data-src"))}}))}),{rootMargin:"200px 0px",threshold:.1});document.querySelectorAll("iframe[data-src]").forEach((t=>{e.observe(t)}))}}connectionAwareLoading(){if("connection"in navigator){const e=navigator.connection;"slow-2g"===e.effectiveType||"2g"===e.effectiveType?this.adjustBatchSize(3):"3g"===e.effectiveType?this.adjustBatchSize(4):this.adjustBatchSize(6)}}adjustBatchSize(e){document.querySelectorAll(".videos-container").forEach((t=>{const n=t.querySelector('[id$="-initial"]');if(n){n.querySelectorAll(".col").forEach(((t,n)=>{n>=e&&(t.style.display="none")}))}}))}optimizeNavigation(){document.addEventListener("mouseover",(e=>{const t=e.target.closest("a");t&&t.href&&!this.preloadedResources.has(t.href)&&(this.preloadPage(t.href),this.preloadedResources.add(t.href))})),document.addEventListener("click",(e=>{const t=e.target.closest("a");t&&t.href&&t.href.startsWith(window.location.origin)&&(this.showNavigationLoading(),this.prefetchPage(t.href))}))}preloadPage(e){const t=document.createElement("link");t.rel="prefetch",t.href=e,document.head.appendChild(t)}prefetchPage(e){fetch(e).then((e=>e.text())).then((t=>{this.cachePage(e,t)})).catch((()=>{}))}cachePage(e,t){this.pageCache||(this.pageCache=new Map),this.pageCache.set(e,t)}showNavigationLoading(){if(!document.getElementById("nav-loading")){const e=document.createElement("div");e.id="nav-loading",e.innerHTML='<div class="loading-spinner"></div>',e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 3px;\n        background: #007bff;\n        z-index: 9999;\n        transform: translateX(-100%);\n        transition: transform 0.3s ease;\n      ";e.querySelector(".loading-spinner").style.cssText="\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(90deg, transparent, #fff, transparent);\n        animation: loading 1s infinite;\n      ",document.body.appendChild(e),setTimeout((()=>{e.style.transform="translateX(0)"}),10)}}setupPerformanceMonitoring(){"performance"in window&&window.addEventListener("load",(()=>{setTimeout((()=>{const e=performance.getEntriesByType("navigation")[0],t=e.loadEventEnd-e.loadEventStart;e.domContentLoadedEventEnd,e.domContentLoadedEventStart;"undefined"!=typeof gtag&&gtag("event","timing_complete",{name:"load",value:Math.round(t)})}),0)}))}registerServiceWorker(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/assets/js/service-worker.js").then((e=>{e.sync&&e.sync.register("preload-pages")})).catch((()=>{}))}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>{new PerformanceOptimizer})):new PerformanceOptimizer;const style=document.createElement("style");style.textContent="\n  @keyframes loading {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n  }\n  \n  .loading-spinner {\n    animation: loading 1s infinite;\n  }\n  \n  /* Optimize transitions for better performance */\n  * {\n    -webkit-transform: translateZ(0);\n    -moz-transform: translateZ(0);\n    -ms-transform: translateZ(0);\n    -o-transform: translateZ(0);\n    transform: translateZ(0);\n  }\n  \n  /* Reduce repaints during animations */\n  .card, .video-container, .spotify-embed-container {\n    will-change: transform;\n  }\n",document.head.appendChild(style);